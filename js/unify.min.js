function providerLogin(provider,oauthOption){if(!provider)return void console.log("Please input provider: facebook, github, google, or twitter");var oauthCallback=function(error,authData){if(!error&&authData){for(var userExists=!1,uid=authData.uid,i=0;i<users.length;i++)if(users[i]==uid){userExists=!0;break}userExists||(authData.today_prices={gold:"loading...",silver:"loading...",platinum:"loading..."},userRef.child(uid).set(authData),users.push(uid))}};"redirect"==oauthOption?firebase.authWithOAuthRedirect(provider,oauthCallback):firebase.authWithOAuthPopup(provider,oauthCallback)}function customSignup(email,password){userRef.createUser({email:email,password:password},function(error,authData){if(error){switch(error.code){case"EMAIL_TAKEN":return console.log("The new user account cannot be created because the email is already in use."),void alert("This email is already taken. Please Try Again");case"INVALID_EMAIL":console.log("The specified email is not a valid email.");break;default:console.log("Error creating user:",error)}$("#password").val("")}else{console.log("Successfully created user account with uid:",authData.uid);for(var userExists=!1,uid=authData.uid,i=0;i<users.length;i++)if(users[i]==uid){userExists=!0;break}userExists||(authData.today_prices={gold:"loading...",silver:"loading...",platinum:"loading..."},authData.email=email,authData.password=CryptoJS.SHA3(password),userRef.child(uid).set(authData),users.push(uid)),alert("Sign up Successful! Welcome to Bullion Tracker!")}customLogin(email,password)})}function customLogin(email,password){userRef.authWithPassword({email:email,password:password},function(error,authData){error?(console.log("Login Failed!",error),alert("Login Failed! Please ensure that your email and password is correct"),$("#password").val("")):console.log("Authenticated successfully with payload:",authData)})}function logout(){firebase.unauth()}function sessionHandler(file_before_auth,file_after_auth){if(!file_before_auth||!file_after_auth)return void console.log("No file detected for before or after authentication");var currentPath=location.pathname,isHome="/"==currentPath||currentPath.contains(file_before_auth),origin=currentPath.substring(0,currentPath.lastIndexOf("/"));inSession&&isHome?location.href=origin+file_after_auth:inSession||isHome||(location.href=origin+file_before_auth)}function getMetalURL(metal){if(!metal||"string"!=typeof metal)return"";switch(metal.toLowerCase()){case"silver":return API_URL+"AG_EIB.json";case"platinum":return API_URL+"PL_MKT.json";default:return API_URL+"AU_EIB.json"}}var path=window.location.pathname,page=path.split("/").pop(),invalidDateInput=!1,invalidQtyInput=!1,invalidWPUInput=!1;$(window).load(function(){function isValidDate(date){var matches=/^(\d{2})[-\/](\d{2})[-\/](\d{4})$/.exec(date);if(null==matches)return!1;var d=matches[2],m=matches[1]-1,y=matches[3],composedDate=new Date(y,m,d);return composedDate.getDate()==d&&composedDate.getMonth()==m&&composedDate.getFullYear()==y}var path=window.location.pathname,page=path.split("/").pop();$(".icon-spinner2").click(function(){location.reload()}),$("#coinStack").on("click","tr",function(){$(this).find("a")[0].click()});var settingsOpen=!1;$(".icon-cog").click(function(){settingsOpen?($(this).velocity("stop").velocity({rotateZ:"0deg"},{duration:500,easing:"easeOutQuad"}),$("#settings").velocity("stop").velocity({height:0},{duration:500,easing:"easeOutQuad"}),settingsOpen=!1):($(this).velocity("stop").velocity({rotateZ:"360deg"},{duration:500,easing:"easeOutQuad"}),$("#settings").velocity("stop").velocity({height:200},{duration:500,easing:"easeOutQuad"}),settingsOpen=!0)});{var winWidth=$(window).width();$(window).height()}$(".mtb-1").click(function(){$(".graph-panel").removeClass("graph-panel-show"),$(".market-status").fadeIn(0),$(".market-list").fadeIn(0),"gold.html"==page&&$(".my_stack").fadeIn(0),$(".mtb-2").removeClass("mobile-toggle-selected"),$(".mtb-1").addClass("mobile-toggle-selected")}),$(".mtb-2").click(function(){$(".market-status").fadeOut(0),$(".market-list").fadeOut(0),"gold.html"==page&&$(".my_stack").fadeOut(0),$(".mtb-1").removeClass("mobile-toggle-selected"),$(".mtb-2").addClass("mobile-toggle-selected"),$(".graph-panel").addClass("graph-panel-show"),drawGraph()});var resizer=function(){winWidth>999&&($(".graph-panel").removeClass("graph-panel-show"),$(".market-status").fadeIn(0),$(".market-list").fadeIn(0),"gold.html"==page&&$(".my_stack").fadeIn(0),$(".mtb-2").removeClass("mobile-toggle-selected"),$(".mtb-1").addClass("mobile-toggle-selected"))};$(window).resize(resizer);var editOpen=!1;$("#edit").click(function(){$(".main-section").css("padding-top"),$(".main-section").css("padding-left"),$(".main-section").css("padding-bottom");editOpen=!0,$("#coin_edit").fadeIn(0).velocity({top:$("#edit").offset().top-$(window).scrollTop(),left:$("#edit").offset().left},0),$("#coin_edit").velocity({top:0,left:0,width:"100%",height:"100%",backgroundColor:"#1D1D1D",paddingTop:63},{duration:600,easing:"easeOutQuint"}),setTimeout(function(){$("#coin_edit").find("*").fadeIn(500)},100),setTimeout(function(){$(window).scrollTop(0),$("#coin_edit_wrapper").velocity({translateY:-$(window).scrollTop()},0)},400)}),$("#icon-close").click(function(){editOpen=!1,$("#coin_edit").velocity({top:$("#edit").offset().top-$(window).scrollTop(),left:$("#edit").offset().left,width:130,height:40,paddingTop:0,backgroundColor:"#397C86"},{duration:600,easing:"easeOutQuint"}).fadeOut(100),$("#coin_edit").find("*").fadeOut(100)}),$(window).scroll(function(){editOpen&&$("#coin_edit_wrapper").velocity({translateY:-$(window).scrollTop()},0)});var defaultDate=new Date,defaultDateInput=("0"+(defaultDate.getMonth()+1)).slice(-2)+"-"+("0"+defaultDate.getDate()).slice(-2)+"-"+defaultDate.getFullYear();$(".purchase_date").val(defaultDateInput),$(".purchase_date").focus(function(){$(this).removeClass("bad-input"),invalidDateInput=!1}),$(".purchase_date").blur(function(){isValidDate(document.getElementsByName("purchase_date")[0].value)||($(this).addClass("bad-input"),$(this).val("MM-DD-YYYY"),invalidDateInput=!0)});var regege=/^[+-]?\d+(\.\d+)?$/;$('input[name="quantity"]').focus(function(){$(this).removeClass("bad-input"),invalidQtyInput=!1}),$('input[name="quantity"]').blur(function(){regege.exec($(this).val())||($(this).addClass("bad-input"),$(this).val("invalid-number"),invalidQtyInput=!0)}),$('input[name="weight_otz"]').focus(function(){$(this).removeClass("bad-input"),invalidWPUInput=!1}),$('input[name="weight_otz"]').blur(function(){regege.exec($(this).val())||($(this).addClass("bad-input"),$(this).val("invalid-number"),invalidWPUInput=!0)});var tableData={Gold:{"US Eagle":{metal_percent:"0.99"},"Bullion Bar":{metal_percent:"0.85"}},Silver:{"US Eagle":{metal_percent:"0.99"},"Bullion Bar":{metal_percent:"0.85"}},Platinum:{"US Eagle":{metal_percent:"0.99"},"Bullion Bar":{metal_percent:"0.85"}}},handleFormChange=function(type){var tr;tr="add"==type?document.getElements("tr"):$("#editTable").find("tr");for(var metal="",bartype="",qty=0,wpu=0,ppo=0,tlw=0,tlm=0,tlc=0,i=0;i<tr.length;i++){var property=tr[i].getElements("td")[0];switch(property.innerHTML){case"Metal":metal=tr[i].getElements("td")[1].getElements("select")[0].value;break;case"Type":bartype=tr[i].getElements("td")[1].getElements("select")[0].value;break;case"Qty.":qty=tr[i].getElements("td")[1].getElements("input")[0].value;break;case"Weight per unit (ozt)":wpu=tr[i].getElements("td")[1].getElements("input")[0].value}}switch(metal){case"Gold":$("#total-metal").text("Total au (ozt)"),$("#metal-perc").text("Gold %");break;case"Silver":$("#total-metal").text("Total ag (ozt)"),$("#metal-perc").text("Silver %");break;case"Platinum":$("#total-metal").text("Total pt (ozt)"),$("#metal-perc").text("Platinum %")}$("#metal-perc").next().text(tableData[metal][bartype].metal_percent),mpc=tableData[metal][bartype].metal_percent;var stackRef=userRef.child(currentUser).child("today_prices");stackRef.child(metal.toLowerCase()).on("value",function(data){if(!data)return void console.log("NOT FOUND");ppo=data.val(),$("#ppo").next().text(ppo);try{qty=parseInt(qty),wpu=parseFloat(wpu),mpc=parseFloat(mpc),tlw=qty*wpu,tlw=tlw.toFixed(2),tlm=tlw*mpc,tlm=tlm.toFixed(2),tlc=tlm*ppo,tlc=tlc.toFixed(2)}catch(err){console.log(err),tlw="invalid",tlm="invalid",tlc="invalid"}$("#total-weight").next().text(tlw),$("#total-metal").next().text(tlm),$("#total-cost").text(tlc)})};$("#addTable").find("*").change(function(){handleFormChange("add")}),$("#editTable").find("*").change(function(){handleFormChange("edit")});try{0!=$("#addTable").length&&handleFormChange("add")}catch(err){console.log("Don't handle form immediately")}});var firebase=new Firebase("https://134b-dreamteam.firebaseio.com/"),userRef=firebase.child("users"),userCollected=!1,inSession=!1,currentUser="",users=[];const API_URL="https://www.quandl.com/api/v1/datasets/WSJ/";String.prototype.contains=function(s){return this.indexOf(s)>-1},Node.prototype.getElements=function(s){switch(s.charAt(0)){case"#":return this.getElementById(s.substring(1));case".":return this.getElementsByClassName(s.substring(1));default:return this.getElementsByTagName(s)}},userRef.on("value",function(data){return data?(data.forEach(function(childSnapshot){users.push(childSnapshot.key())}),void(userCollected=!0)):void console.log("No users found in Firebase")},function(error){console.log(error)}),firebase.onAuth(function(authData){inSession=Boolean(authData)?!0:!1,inSession&&(currentUser=authData.uid),sessionHandler("/index.html","/home.html")});var StackManager=function(){var metal="";return inSession?(this.stackRef=userRef.child(currentUser).child("coinStack"),metal=location.href.contains("gold")?"gold":location.href.contains("silver")?"silver":location.href.contains("platinum")?"platinum":"",void(this.metal=metal)):void(this.metal="")};StackManager.prototype.toString=function(){return this.metal},StackManager.prototype.construct=function(id,img){for(var tr=document.getElements(id).getElements("tr"),coinStack={},i=0;i<tr.length;i++){var property=tr[i].getElements("td")[0];property.innerHTML.contains("strong")&&(property=property.getElements("strong")[0]);var td=tr[i].getElements("td")[1],tdStr=td.innerHTML.replace(/(^\s+|\s+$)/g,"");value=tdStr.contains("select")?td.getElements("select")[0].value:tdStr.contains("input")?td.getElements("input")[0].value:tdStr.contains("strong")?td.getElements("strong")[0].innerHTML:td.innerHTML,property=property.innerHTML.toLowerCase().replace(/\s+/g,"_"),property=property.replace(/[\.|#|\$|\/|\[|\]]*/g,""),coinStack[property]=value}return coinStack.image=Boolean(img)?img:"",coinStack},StackManager.prototype.addCoin=function(newStack){switch(newStack.metal){case"Gold":metalRef=this.stackRef.child("gold");break;case"Silver":metalRef=this.stackRef.child("silver");break;case"Platinum":metalRef=this.stackRef.child("platinum");break;default:return void(metalRef=null)}metalRef.push(newStack)},StackManager.prototype.read=function(){metal=location.pathname.contains("gold")?"gold":location.pathname.contains("silver")?"silver":location.pathname.contains("platinum")?"platinum":"",metal&&this.stackRef.child(metal).on("value",function(data){if(!data)return void console.log("No coins found in Firebase");var list=data.val();for(var key in list)if(list.hasOwnProperty(key)&&"total"!=key){for(var coin=list[key],row=document.createElement("tr"),data=['<div class="coin_mini"></div>','<a href="'+metal+"_detail.html?id="+key+'"></a>'+coin.type,coin.qty,coin["total_weight_(ozt)"],coin.purchase_date,coin.total],i=0;i<data.length;i++){var td=document.createElement("td");0==i&&(td.className="stack_img_col"),td.innerHTML=data[i],row.appendChild(td)}var css={"background-image":'url("'+list[key].image+'")',"background-size":"100% auto","background-repeat":"no-repeat","background-position":"center"};$("#coinStack").append('<tr id="'+key+'">'+row.innerHTML+"</tr>"),list[key].image&&(css["background-color"]="transparent"),$("#"+key+" > td > .coin_mini").css(css)}})},StackManager.prototype.total=function(){switch(this.metal){case"gold":reference=this.stackRef.child("gold");break;case"silver":reference=this.stackRef.child("silver");break;case"platinum":reference=this.stackRef.child("platinum");break;default:reference=null}null!=reference?reference.on("value",function(data){var total=0;data.forEach(function(childSnapshot){total+=parseFloat(childSnapshot.val().total)}),total=total.toFixed(2).toString(),total=total.replace(/\B(?=(\d{3})+(?!\d))/g,","),$(".total-dollars").text("$"+total)}):this.stackRef.on("value",function(data){var total=0;data.forEach(function(childSnapshot){childSnapshot.forEach(function(grandchild){total+=parseFloat(grandchild.val().total)})}),total=total.toFixed(2).toString(),total=total.replace(/\B(?=(\d{3})+(?!\d))/g,","),$(".total-dollars").text("$"+total)})},StackManager.prototype.validate=function(query){metal=location.pathname.contains("gold")?"gold":location.pathname.contains("silver")?"silver":location.pathname.contains("platinum")?"platinum":"";var access=null;try{if(access=query.split("=")[1],!metal)return}catch(err){return void console.log(err)}this.stackRef.child(metal).on("value",function(data){if(!data)return void console.log("No coins found in Firebase");var valid=!1;data.forEach(function(childSnapshot){var key=childSnapshot.key();return"total"!=key&&key==access?void(valid=!0):void 0}),valid||(location.href=metal+".html")})},StackManager.prototype.loadCoin=function(query){var coinRef=null;try{coinRef=this.stackRef.child(this.metal).child(query.split("=")[1])}catch(err){return void console.log(err)}coinRef.on("value",function(data){for(var tr=document.getElements("#viewTable").getElements("tr"),properties=[],i=0;i<tr.length;i++){var td=tr[i].getElements("td"),property=td[0].innerHTML;property.contains("strong")&&(property=td[0].getElements("strong")[0].innerHTML),property=property.toLowerCase().replace(/\s+/g,"_"),property=property.replace(/[\.|#|\$|\/|\[|\]]*/g,""),td[1].innerHTML=data.val()[property],properties.push(property)}tr=document.getElements("#editTable").getElements("tr");for(var i=0;i<tr.length;i++){var td=tr[i].getElements("td")[1];td.innerHTML.contains("select")?td.getElements("select")[0].value=data.val()[properties[i]]:td.innerHTML.contains("input")?td.getElements("input")[0].value=data.val()[properties[i]]:td.innerHTML.contains("strong")?td.getElements("strong")[0].innerHTML=data.val()[properties[i]]:td.innerHTML=data.val()[properties[i]]}data.val().image&&($($(".img_circle")[1]).css({display:"none",visibility:"hidden"}),$(".img_circle").hide()),$(".img_box").css({"background-image":'url("'+data.val().image+'")',"background-size":"100% auto","background-repeat":"no-repeat","background-position":"center"})})},StackManager.prototype.editCoin=function(query,oldStack){var coinRef=null;try{coinRef=this.stackRef.child(this.metal).child(query.split("=")[1])}catch(err){return void console.log(err)}coinRef.update(oldStack)},StackManager.prototype.deleteCoin=function(query){var metalRef=this.stackRef.child(this.metal),coinRef=null;try{coinRef=metalRef.child(query.split("=")[1])}catch(err){return void console.log(err)}coinRef.remove(function(error){error&&console.log("Remove Failed")})},$(document).ready(function(){function imageLoaded(e){$(".img_circle").hide(),$("#img_holder").css({"background-image":'url("'+e.target.result+'")',"background-size":"100% auto","background-repeat":"no-repeat","background-position":"center"});var imageUrl=e.target.result;convertImgToBase64(imageUrl,function(){})}function convertImgToBase64(url,callback,outputFormat){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),img=new Image;img.crossOrigin="Anonymous",img.onload=function(){canvas.height=img.height,canvas.width=img.width,ctx.drawImage(img,0,0);var dataURL=canvas.toDataURL(outputFormat||"image/png");callback.call(this,dataURL),canvas=null,imgBase=dataURL},img.src=url}var stack=new StackManager,metal=stack.toString(),imgBase="",email_re=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,email_focused=!1;$("#google-button").click(function(){providerLogin("google")}),$("#facebook-button").click(function(){providerLogin("facebook")}),$("#twitter-button").click(function(){providerLogin("twitter")}),$("#email").focus(function(){email_focused=!0}),$("#email").keyup(function(e){var email=$(this).val();13==e.keyCode&&$("#password").focus(),email_re.exec(email)?($(this).css({color:"white"}),$("#email").focus(function(){$(this).css({outline:"2px solid #68CEDE"})})):$(this).css({color:"#FF4747"})}),$("#email").keydown(function(){var email=$(this).val();$(this).css(email_re.exec(email)?{color:"white"}:{color:"#FF4747"})}),$("#password").keyup(function(e){if(13==e.keyCode){var email=$("#email").val(),password=$("#password").val();if(0==email.length)return void $("#email").focus();if(0==password.length)return void alert("Either email or password is empty. Please check again");customLogin(email,password)}}),$("#sign-up-button").click(function(){var email=$("#email").val();if(!email_re.exec(email))return void $("#email").css({color:"#FF4747"});var password=$("#password").val();customSignup(email,password)}),$("#log-in-button").click(function(){var email=$("#email").val();if(!email_re.exec(email))return void $("#email").css({color:"#FF4747"});var password=$("#password").val();customLogin(email,password)}),$("#logout").click(function(){logout()}),$("#image_upload").click(function(){$(this).children()[0].click()}),$("#uploader").change(function(){if(this.files&&this.files[0]){var reader=new FileReader;reader.onload=imageLoaded,reader.readAsDataURL(this.files[0])}}),$("#save").click(function(){var badOutputString="";invalidDateInput&&(badOutputString+="Invalid Date Format\n"),invalidQtyInput&&(badOutputString+="Invalid Qty Format\n"),invalidWPUInput&&(badOutputString+="Invalid Weight Format\n"),badOutputString.length>0?alert(badOutputString):(stack.addCoin(stack.construct("#addTable",imgBase)),tmpMetal=document.getElements("select")[0].value,tmpMetal=tmpMetal.toLowerCase(),location.href=tmpMetal+".html")}),$("#edited").click(function(){var badOutputString="";invalidDateInput&&(badOutputString+="Invalid Date Format\n"),invalidQtyInput&&(badOutputString+="Invalid Qty Format\n"),invalidWPUInput&&(badOutputString+="Invalid Weight Format\n"),badOutputString.length>0?alert(badOutputString):(stack.editCoin(location.search,stack.construct("#editTable",imgBase)),location.href=metal+".html")}),$("#delete").click(function(){location.pathname.contains("_detail")&&(stack.deleteCoin(location.search),location.href=metal+".html")}),location.pathname.contains("_detail")&&(stack.validate(location.search),stack.loadCoin(location.search)),inSession&&(metal&&stack.read(),stack.total())}),-1==page.indexOf("add")&&-1==page.indexOf("detail")&&$(document).ready(function(){function CSVToArray(strData,strDelimiter){strDelimiter=strDelimiter||",";for(var objPattern=new RegExp("(\\"+strDelimiter+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+strDelimiter+"\\r\\n]*))","gi"),arrData=[[]],arrMatches=null;arrMatches=objPattern.exec(strData);){var strMatchedDelimiter=arrMatches[1];strMatchedDelimiter.length&&strMatchedDelimiter!==strDelimiter&&arrData.push([]);var strMatchedValue;strMatchedValue=arrMatches[2]?arrMatches[2].replace(new RegExp('""',"g"),'"'):arrMatches[3],arrData[arrData.length-1].push(strMatchedValue)}return arrData}function getMetalJSON(json_url,metal){$.ajax({type:"GET",dataType:"text",url:json_url,crossDomain:!0,xhrFields:{withCredentials:!1}}).done(function(csvdata){var csvArray=CSVToArray(csvdata,",");csvArray=csvArray.slice(1,csvArray.length-1),csvArray.reverse();for(var preprocessedArray=[],processedArray=[],xlabelfirst=xlabel[0],lastPrice=csvArray[0][1],csvarrayfirst=new Date(csvArray[0][0]),csvIter=0;xlabelfirst!=csvarrayfirst.getMonth()+1+"-"+("0"+csvarrayfirst.getDate()).slice(-2);)csvarrayfirst.valueOf()==new Date(csvArray[csvIter+1][0]).valueOf()&&(csvIter++,lastPrice=csvArray[csvIter][1]),csvarrayfirst.setDate(csvarrayfirst.getDate()+1);for(preprocessedArray.push([csvarrayfirst.getFullYear()+"-"+("0"+(csvarrayfirst.getMonth()+1)).slice(-2)+"-"+("0"+csvarrayfirst.getDate()).slice(-2),lastPrice]),i=1;i<xlabel.length;i++)csvarrayfirst.setDate(csvarrayfirst.getDate()+1),preprocessedArray.push([csvarrayfirst.getFullYear()+"-"+("0"+(csvarrayfirst.getMonth()+1)).slice(-2)+"-"+("0"+csvarrayfirst.getDate()).slice(-2),lastPrice]),null!=csvArray[csvIter+1]&&csvarrayfirst.valueOf()==new Date(csvArray[csvIter+1][0]).valueOf()&&(csvIter++,lastPrice=csvArray[csvIter][1]);for(i=0;i<preprocessedArray.length;i++)processedArray.push(preprocessedArray[i][1]);switch(metal){case"gold":gold1oz=processedArray,getMyMetal("gold");break;case"silver":silver1oz=processedArray,getMyMetal("silver");break;case"platinum":plat1oz=processedArray,getMyMetal("platinum")}waitFor--,0==waitForTotal&&0==waitFor&&drawGraph(graphsToDraw),0==waitFor&&inSession&&"home.html"==page&&userRef.child(currentUser).child("today_prices").update({gold:gold1oz[gold1oz.length-1],silver:silver1oz[gold1oz.length-1],platinum:plat1oz[plat1oz.length-1]})}).fail(function(){})}function popMarketList(page){$.ajax({type:"GET",dataType:"text",url:"https://cse134b.herokuapp.com/jm",crossDomain:!0,xhrFields:{withCredentials:!1}}).done(function(csvdata){var jsonAB=eval(csvdata);if("home.html"==page)for(var i=0;3>i;i++){var bid=jsonAB[i].bid,ask=jsonAB[i].ask,change=jsonAB[i].oneDayChange,header=document.getElementsByClassName("market-item-stats");header[i].getElementsByTagName("td")[0].innerHTML=bid,header[i].getElementsByTagName("td")[1].innerHTML=ask;var elmtChange=header[i].getElementsByTagName("td")[2];elmtChange.innerHTML=change,elmtChange.className=change>=0?"pos-change":"neg-change"}else{var i;if("gold.html"==page)i=0;else if("silver.html"==page)i=1;else{if("platinum.html"!=page)return;i=2}var bid=jsonAB[i].bid,ask=jsonAB[i].ask,change=jsonAB[i].oneDayChange,header=document.getElementsByClassName("market-item-stats");header[0].getElementsByTagName("td")[0].innerHTML=bid,header[0].getElementsByTagName("td")[1].innerHTML=ask;var elmtChange=header[0].getElementsByTagName("td")[2];elmtChange.innerHTML=change,elmtChange.className=change>=0?"pos-change":"neg-change"}}).fail(function(){})}function getMetalPrice(metal,start,end){var json_url="https://www.quandl.com/api/v1/datasets/WSJ/";switch(metal){case"gold":json_url+="AU_EIB";break;case"silver":json_url+="AG_EIB";break;case"platinum":json_url+="PL_MKT"}json_url+=".csv?auth_token=WhJThfjMzZMAu-2CQK5-&trim_start="+start,end&&(json_url+="&trim_end="+end),getMetalJSON(json_url,metal)}var gold1oz=[],silver1oz=[],plat1oz=[],goldtotal=[],silvertotal=[],plattotal=[],alltotal=[],xlabel=[],waitFor,waitForTotal,graphsToDraw,everyOtherX=2,options={scaleShowGridLines:!0,scaleGridLineColor:"rgba(104, 206, 222, 0.1)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',responsive:!0,maintainAspectRatio:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null},coinChart,drawGraph=function(metal){var pointStroke="rgba(255,255,255,0.6)",pointHighlightFill="#fff",pointHighlightStroke="#fff";for(i=0;i<xlabel.length;i++)i%everyOtherX!=0&&(xlabel[i]="");if("all"==metal)var data={labels:xlabel,datasets:[{label:"Gold Total",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#FF6D67",pointColor:"#FF6D67",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:goldtotal},{label:"Platinum Total",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#FFA859",pointColor:"#FFA859",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:plattotal},{label:"Silver Total",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#F3FF88",pointColor:"#F3FF88",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:silvertotal},{label:"1oz Gold",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#9FFF98",pointColor:"#9FFF98",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:gold1oz},{label:"1oz Platinum",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#BBF5FF",pointColor:"#BBF5FF",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:plat1oz},{label:"1oz Silver",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#C29FFF",pointColor:"#C29FFF",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:silver1oz}]};else if("gold"==metal)var data={labels:xlabel,datasets:[{label:"Gold Total",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#FF6D67",pointColor:"#FF6D67",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:goldtotal},{label:"1oz Gold",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#9FFF98",pointColor:"#9FFF98",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:gold1oz}]};else if("silver"==metal)var data={labels:xlabel,datasets:[{label:"Silver Total",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#F3FF88",pointColor:"#F3FF88",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:silvertotal},{label:"1oz Silver",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#C29FFF",pointColor:"#C29FFF",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:silver1oz}]};else if("platinum"==metal)var data={labels:xlabel,datasets:[{label:"Platinum Total",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#FFA859",pointColor:"#FFA859",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:plattotal},{label:"1oz Platinum",fillColor:"rgba(104, 206, 222, 0.05)",strokeColor:"#BBF5FF",pointColor:"#BBF5FF",pointStrokeColor:pointStroke,pointHighlightFill:pointHighlightFill,pointHighlightStroke:pointHighlightStroke,data:plat1oz}]};var ctx=document.getElementById("total-chart").getContext("2d");null!=coinChart&&coinChart.destroy(),coinChart=new Chart(ctx).Line(data,options),coinChart.update()},calcdailychange=function(){if("home.html"==page){for(i=0;i<plattotal.length;i++)alltotal.push(goldtotal[i]+silvertotal[i]+plattotal[i]);var perc=(alltotal[alltotal.length-1]-alltotal[alltotal.length-2])/alltotal[alltotal.length-2];0==alltotal[alltotal.length-2]&&(perc=0),perc=(100*perc).toFixed(1),perc>=0?($(".total-change").addClass("pos-change"),$(".total-change").text("+"+perc+"%")):($(".total-change").addClass("neg-change"),$(".total-change").text("-"+perc+"%"))}},getMyMetal=function(metal){var stackRef=userRef.child(currentUser).child("coinStack");switch(metal.toLowerCase()){case"gold":metaltotal=goldtotal.slice(),metal1oz=gold1oz.slice();break;case"silver":metaltotal=silvertotal.slice(),metal1oz=silver1oz.slice();break;case"platinum":metaltotal=plattotal.slice(),metal1oz=plat1oz.slice();break;default:return}stackRef.child(metal).on("value",function(data){if(!data)return void console.log("No coins found in Firebase");var list=data.val();for(var key in list)if(list.hasOwnProperty(key)&&"total"!=key){var coin=list[key],coinPurch=coin.purchase_date,coinOzt=coin["total_weight_(ozt)"],coinPurchDate=new Date(coinPurch),currDate=new Date,distanceDate=Math.floor((currDate-coinPurchDate)/864e5);for(i=0;i<metaltotal.length&&i<distanceDate+1;i++)metaltotal[metaltotal.length-1-i]+=coinOzt*metal1oz[i];switch(metal.toLowerCase()){case"gold":goldtotal=metaltotal.slice(),gold1oz=metal1oz.slice();break;case"silver":silvertotal=metaltotal.slice(),silver1oz=metal1oz.slice();break;case"platinum":plattotal=metaltotal.slice(),plat1oz=metal1oz.slice();break;default:return}}if(waitForTotal--,0==waitForTotal&&0==waitFor&&(drawGraph(graphsToDraw),calcdailychange()),page==metal+".html"){var perc=(metaltotal[metaltotal.length-1]-metaltotal[metaltotal.length-2])/metaltotal[metaltotal.length-2];0==metaltotal[metaltotal.length-2]&&(perc=0),perc=(100*perc).toFixed(1),perc>=0?($(".daily-change").addClass("pos-change"),$(".daily-change").text("+"+perc+"%")):($(".daily-change").addClass("neg-change"),$(".daily-change").text("-"+perc+"%"));var perc=(metaltotal[metaltotal.length-1]-metaltotal[0])/metaltotal[0];0==metaltotal[0]&&(perc=0),perc=(100*perc).toFixed(1),perc>=0?($(".overall-change").addClass("pos-change"),$(".overall-change").text("+"+perc+"%")):($(".overall-change").addClass("neg-change"),$(".overall-change").text("-"+perc+"%"))}})};popMarketList(page);var daysBack=31,date=new Date,currDate=date.getFullYear()+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2);date.setDate(date.getDate()-daysBack-7);var pastDate=date.getFullYear()+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2),xlabeldate=new Date;for(i=0;i<daysBack;i++)xlabel[daysBack-i-1]=xlabeldate.getMonth()+1+"-"+("0"+xlabeldate.getDate()).slice(-2),xlabeldate.setDate(xlabeldate.getDate()-1),goldtotal.push(0),silvertotal.push(0),plattotal.push(0);"home.html"==page?(graphsToDraw="all",waitFor=3,waitForTotal=3,getMetalPrice("gold",pastDate,currDate),getMetalPrice("silver",pastDate,currDate),getMetalPrice("platinum",pastDate,currDate)):"gold.html"==page?(graphsToDraw="gold",waitFor=1,waitForTotal=1,getMetalPrice("gold",pastDate,currDate)):"silver.html"==page?(graphsToDraw="silver",waitFor=1,waitForTotal=1,getMetalPrice("silver",pastDate,currDate)):"platinum.html"==page&&(graphsToDraw="platinum",waitFor=1,waitForTotal=1,getMetalPrice("platinum",pastDate,currDate))});